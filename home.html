<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FPT Book - Home</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css">
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">FPT Book</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <form class="form-inline my-2 my-lg-0" id="searchForm">
        <input class="form-control mr-sm-2" type="search" placeholder="Tìm kiếm sách" aria-label="Search"
          id="searchInput">
        <button class="btn btn-outline-success my-2 my-sm-0" type="button" onclick="searchBooks()">Tìm kiếm</button>
      </form>
    </div>
  </nav>

  <div class="container mt-5">
    <!-- Nội dung ngắn về FPT Book -->
    <div class="jumbotron">
      <h1 class="display-4">Chào mừng bạn đến với FPT Book</h1>
      <p class="lead">FPT Book là nơi tổng hợp đa dạng sách với nhiều thể loại và tác giả khác nhau. Hãy khám phá
        thế giới tri thức thông qua những trang sách tuyệt vời!</p>
    </div>

    <!-- Sách mới cập nhật -->
    <h2>Sách mới cập nhật</h2>
    <div id="recent-books">
      <!-- Danh sách sách mới cập nhật sẽ được thêm vào đây -->
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Lấy và hiển thị sách mới cập nhật mặc định
      fetchRecentBooks();

      // Lắng nghe sự kiện khi thực hiện tìm kiếm
      const searchForm = document.getElementById("searchForm");
      searchForm.addEventListener("submit", function (event) {
        event.preventDefault();
        searchBooks();
      });
    });

    function fetchRecentBooks() {
      fetch("/get-recent-books")
        .then(response => {
          if (!response.ok) {
            throw new Error(`Lỗi HTTP! Trạng thái: ${response.status}`);
          }
          return response.json();
        })
        .then(books => displayBooks("recent-books", books, ""))
        .catch(error => console.error('Lỗi khi lấy sách:', error));
    }

    function displayBooks(containerId, books, message) {
      const container = document.getElementById(containerId);

      // Hiển thị thông báo kết quả tìm kiếm (nếu có)
      if (message) {
        const messageElement = document.createElement("p");
        messageElement.textContent = message;
        container.appendChild(messageElement);
      }

      // Hiển thị card sách
      books.forEach((book, index) => {
        if (index % 5 === 0) {
          // Mỗi khi index là bội số của 5, tạo một dòng mới
          const row = document.createElement("div");
          row.className = "row";
          container.appendChild(row);
        }

        const row = container.lastElementChild;
        const card = document.createElement("div");
        card.className = "card mb-3 col-md-2 ml-4";
        card.setAttribute("data-book-id", book._id);
        card.innerHTML = `
          <div class="row no-gutters">
            <div class="col-md-12">
              <div class="card-body">
                <h5 class="card-title">${book.title}</h5>
                <p class="card-text">${book.author}</p>
                <p class="card-text">${book.publicationYear}</p>
              </div>
            </div>
          </div>
        `;

        // Thêm sự kiện click cho card
        card.addEventListener("click", () => {
          const bookId = card.getAttribute("data-book-id");
          window.location.href = `/detailBook.html?id=${bookId}`;
        });

        row.appendChild(card);
      });
    }

    function searchBooks() {
      const searchTerm = document.getElementById("searchInput").value;
      const recentBooksContainer = document.getElementById("recent-books");

      // Xóa nội dung hiện tại trong container
      recentBooksContainer.innerHTML = '';

      if (searchTerm.trim() !== "") {
        fetch(`/search?query=${searchTerm}`)
          .then(response => {
            if (!response.ok) {
              throw new Error(`Lỗi HTTP! Trạng thái: ${response.status}`);
            }
            return response.json();
          })
          .then(books => displayBooks("recent-books", books, `Kết quả tìm kiếm cho: "${searchTerm}"`))
          .catch(error => console.error('Lỗi khi tìm kiếm sách:', error));
      } else {
        // Nếu không có giá trị tìm kiếm, hiển thị sách mới cập nhật mặc định
        fetchRecentBooks();
      }
    }


    function logout() {
      fetch("/logout", {
        method: "POST",
      })
        .then(() => {
          // Sau khi đăng xuất, làm mới trang hoặc ẩn nút đăng nhập và đăng ký bằng JavaScript
          window.location.reload();
          // hoặc
          // document.getElementById("loginLink").style.display = "none";
          // document.getElementById("registerLink").style.display = "none";
        });
    }
  </script>




</body>

</html>